Perfect â€” I will give you **both**:

âœ… Full Django mini-project ZIP structure (you can copy/paste files)
âœ… Minimal **single Python file** version (for testing)
âœ… Works **before hosting** â€” localhost redirect, login, consent, token storage
âœ… Fixes your error:

> *â€œNo reply URL configuredâ€ + â€œAccessDeniedâ€ when sending emailâ€*

---

## âœ… Step 1 â€” Required Azure AD settings (Corporate Account)

Go to **Azure Portal â†’ Azure AD â†’ App Registrations â†’ Your App**
Configure like this:

### **Authentication**

| Setting                   | Value                                              |
| ------------------------- | -------------------------------------------------- |
| Platform                  | **Web**                                            |
| Redirect URL              | `http://localhost:8000/auth/callback/`             |
| Allow public client flows | âœ… `Enable Allow public client flows` (for testing) |
| Treat as public client    | âœ… Enabled                                          |

### **API Permissions**

Go to **API permissions â†’ Add a permission â†’ Microsoft Graph â†’ Delegated**

Add:

* `Mail.ReadWrite`
* `Mail.Send`
* `offline_access` âœ… *(needed for refresh token)*
* `User.Read`

Then click **Grant admin consent** âœ… *(important or AccessDenied will happen)*

### **Certificates & Secrets**

Create:

* **Client Secret** â†’ copy value

---

## âœ… Step 2 â€” `.env` File in Django Project

Create `.env` file:

```env
CLIENT_ID=YOUR_CLIENT_ID
CLIENT_SECRET=YOUR_SECRET
TENANT_ID=YOUR_TENANT_ID
REDIRECT_URI=http://localhost:8000/auth/callback/
SCOPES=openid profile offline_access Mail.Send Mail.ReadWrite User.Read
```

---

## âœ… Step 3 â€” Minimal Python Test Script (before Django)

Save as `ms_login_test.py` â€” this verifies token + email send works.

> **Run first!** To verify your configuration before using Django.

```python
import msal, requests, webbrowser

CLIENT_ID = "YOUR_CLIENT_ID"
CLIENT_SECRET = "YOUR_CLIENT_SECRET"
TENANT_ID = "YOUR_TENANT_ID"
REDIRECT_URI = "http://localhost:8000/auth/callback/"
SCOPES = ["Mail.Send", "Mail.ReadWrite", "offline_access", "User.Read"]

AUTH_URL = f"https://login.microsoftonline.com/{TENANT_ID}/oauth2/v2.0/authorize"
TOKEN_URL = f"https://login.microsoftonline.com/{TENANT_ID}/oauth2/v2.0/token"

app = msal.ConfidentialClientApplication(
    CLIENT_ID, authority=f"https://login.microsoftonline.com/{TENANT_ID}", client_credential=CLIENT_SECRET
)

auth_url = app.get_authorization_request_url(SCOPES, redirect_uri=REDIRECT_URI)
print("Login URL:", auth_url)
webbrowser.open(auth_url)

auth_code = input("Paste auth code from URL here: ")

token = app.acquire_token_by_authorization_code(
    auth_code, scopes=SCOPES, redirect_uri=REDIRECT_URI
)

access = token.get("access_token")

msg = {
    "message": {
        "subject": "Test email from Python",
        "body": {"contentType": "Text", "content": "Hello from MS Graph!"},
        "toRecipients": [{"emailAddress": {"address": "YOUR_EMAIL"}}]
    }
}

response = requests.post(
    "https://graph.microsoft.com/v1.0/me/sendMail",
    headers={"Authorization": f"Bearer {access}", "Content-Type": "application/json"},
    json=msg
)

print("Mail send status:", response.status_code, response.text)
```

Run:

```bash
python ms_login_test.py
```

âœ… If mail sends â†’ your credentials & permissions are **correct**
âŒ If `AccessDenied` â†’ admin consent missing

---

## âœ… Step 4 â€” Django Project ZIP (structure)

Here is project tree (I will give code next message):

```
msgraph_email_project/
 â”œâ”€ manage.py
 â”œâ”€ .env
 â”œâ”€ requirements.txt
 â”œâ”€ msgraph_email/
 â”‚   â”œâ”€ settings.py
 â”‚   â”œâ”€ urls.py
 â”‚   â”œâ”€ views.py
 â”‚   â””â”€ models.py  # stores token DB
 â””â”€ templates/
     â”œâ”€ login.html
     â””â”€ success.html
```

Content includes:

* `/login/` â†’ Microsoft login
* `/auth/callback/` â†’ receives token
* Token stored in DB
* `/send/` â†’ send email

I will paste **all files directly** next message so you can zip them.

---

## âœ… Tell me now:

Do you want the email-sending UI like:

A) **Simple button** â€œSend Test Emailâ€
B) **Form**: To Email | Subject | Body
C) **Both**

Reply: `A`, `B`, or `C`

I will then send:

ğŸ“ Full Django project code
ğŸ“¦ Zip-ready folder structure
ğŸ§  Instructions to run
ğŸ¯ Next step: scheduling background email jobs if needed

Reply with choice ğŸ‘‡
